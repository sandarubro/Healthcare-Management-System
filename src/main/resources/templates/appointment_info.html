<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin Information</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Otomanopee+One:wght@400&display=swap">




    <style>
        #content-container {
            position: relative;
            z-index: 1;
            margin-left: 340px;
            width: calc(100% - 340px);
            height: 100%;
        }

        .layout-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        body {
            margin: 0;
            line-height: normal;
        }

        :root {
            /* Fonts */
            --font-poppins: Poppins;

            /* font sizes */
            --font-size-base: 16px;

            /* Colors */
            --color-black: #000;
            --color-darkslateblue: #3b4ba0;
            --color-tomato: #f55548;
            --color-white: #fff;

            /* Border radiuses */
            --br-5xs: 8px;
        }

        .group-child {
            position: absolute;
            top: 0px;
            left: 0px;
            border-radius: 5px;
            background-color: var(--color-darkslateblue);
            width: 154px;
            height: 41px;
            cursor: pointer;
        }
        .group-child:hover {
            background-color: var(--color-white);
            border: 1px solid var(--color-darkslateblue);
            color: var(--color-darkslateblue);
        }

        .fi-sr-plus-small-icon {
            position: absolute;
            height: 68.78%;
            width: 18.31%;
            top: 15.63%;
            right: 77.49%;
            bottom: 15.59%;
            left: 4.2%;
            max-width: 100%;
            overflow: hidden;
            max-height: 100%;
        }
        .group-child:hover .fi-sr-plus-small-icon {
            filter: brightness(0) saturate(100%) invert(26%) sepia(89%) saturate(748%) hue-rotate(197deg) brightness(89%) contrast(91%);
        }
        .sumanth-tinson {
            position: absolute;
            top: 21.88%;
            left: 25%;
        }
        .rectangle-parent {
            position: absolute;
            top: 0px;
            left: 1251px;
            width: 154px;
            height: 41px;
        }
        .patients {
            position: absolute;
            top: 0%;
            left: 0%;
        }
        .patients-wrapper {
            position: absolute;
            height: 87.8%;
            width: 9.25%;
            top: 0%;
            right: 90.75%;
            bottom: 12.2%;
            left: 0%;
            font-size: 24px;
            color: var(--color-black);
        }
        .group-container {
            position: absolute;
            top: 0px;
            left: 0px;
            width: 1405px;
            height: 41px;
        }

        /* New Table Styles */
        .custom-admin-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background-color: var(--color-white);
        }

        .custom-admin-table thead th {
            background-color: transparent;
            border-bottom: 1px solid var(--color-black);

            padding: 15px;
            font-weight: bold;
            color: var(--color-black);
        }

        .custom-admin-table tbody tr {
            height: 65px;
            border-bottom: 1px solid var(--color-black);
        }

        .custom-admin-table tbody td {
            padding: 15px;
            vertical-align: middle;
            border-bottom: 1px solid var(--color-black);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 20px;

        }

        .group-child1, .group-child2 {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 38px;
            height: 38px;
            border-radius: var(--br-5xs);
            cursor: pointer;
        }

        .group-child1 {
            background-color: var(--color-tomato);
        }
        .group-child1:hover {
            background-color: #CF4438 !important;
        }

        .group-child2 {
            background-color: var(--color-darkslateblue);
        }
        .group-child2:hover {
            background-color: #2C387A !important;
        }

        .pencil-fill-icon {
            width: 16px;
            height: 16px;
        }

        .layer-2-icon{
            width: 25px;
            height: 25px;
        }

        .rectangle-group {
            position: absolute;
            top: 117px;
            left: 0px;
            width: 1405px;
            height: 230px;
            color: var(--color-black);
        }

        .group-parent {
            width: 100%;
            position: relative;
            height: 347px;
            text-align: left;
            font-size: var(--font-size-base);
            color: var(--color-white);
            font-family: var(--font-poppins);
            top: 100px;
        }
    </style>
</head>
<body>

<!-- Layout container (fixed position) -->
<div id="layout-container" class="layout-container"></div>

<!-- Content container (positioned next to sidebar) -->
<div id="content-container">
    <div class="scaling-container">
        <div class="group-parent">
            <div class="group-container">
                <div class="rectangle-parent">
                    <div class="group-child">
                        <img class="fi-sr-plus-small-icon" alt="" src="/static/images/fi-sr-plus-small.svg">
                        <div class="sumanth-tinson">New Appt</div>
                    </div>
                </div>
                <div class="patients-wrapper">
                    <div class="patients">Appt Info</div>
                </div>
            </div>

            <!-- Updated Table Structure -->
            <div class="rectangle-group">
                <div class="table-responsive">
                    <table class="table table-borderless custom-admin-table">
                        <thead>
                        <tr>
                            <th style="width: 20%">Patient Name</th>
                            <th style="width: 15%">Age</th>
                            <th style="width: 15%">Date</th>
                            <th style="width: 15%">Time</th>
                            <th style="width: 20%">Doctor Name</th>
                            <th style="width: 10%" >Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- Row 1 -->
                        <tr>
                            <td>Piumal Fernando</td>
                            <td>0775688755</td>
                            <td>0775688755</td>
                            <td>example@gmail.com</td>
                            <td class="text-end">
                                <div class="action-buttons">
                                    <div class="group-child2">
                                        <img class="pencil-fill-icon" alt="Edit" src="/static/images/pencil-fill.svg">
                                    </div>
                                    <div class="group-child1">
                                        <img class="layer-2-icon" alt="Delete" src="/static/images/Layer 2.svg">
                                    </div>
                                </div>
                            </td>
                        </tr>

                        <!-- Row 2 -->
                        <tr>
                            <td>Hasith Madhushan</td>
                            <td>0775688755</td>
                            <td>0775688755</td>
                            <td>example@gmail.com</td>
                            <td class="text-end">
                                <div class="action-buttons">
                                    <div class="group-child2">
                                        <img class="pencil-fill-icon" alt="Edit" src="/static/images/pencil-fill.svg">
                                    </div>
                                    <div class="group-child1">
                                        <img class="layer-2-icon" alt="Delete" src="/static/images/Layer 2.svg">
                                    </div>
                                </div>
                            </td>
                        </tr>

                        <!-- Row 3 -->
                        <tr>
                            <td>Chathura De Silva</td>
                            <td>0775688755</td>
                            <td>0775688755</td>
                            <td>example@gmail.com</td>
                            <td class="text-end">
                                <div class="action-buttons">
                                    <div class="group-child2">
                                        <img class="pencil-fill-icon" alt="Edit" src="/static/images/pencil-fill.svg">
                                    </div>
                                    <div class="group-child1">
                                        <img class="layer-2-icon" alt="Delete" src="/static/images/Layer 2.svg">
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap Modal -->
<div class="modal fade" id="newAdminModal" tabindex="-1" aria-labelledby="newAdminModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="newAdminModalLabel">New Appointment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="adminName" placeholder=" " required>
                        <label for="adminName">Patient Name</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="adminAge" placeholder=" " required>
                        <label for="adminAge">Age</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="date" class="form-control" id="adminDate" placeholder=" " required>
                        <label for="adminDate">Date</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="time"  class="form-control" id="adminTime" placeholder=" " required>
                        <label for="adminTime">Time</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="adminDoctorName" placeholder=" " required>
                        <label for="adminDoctorName">Doctor Name</label>
                    </div>




                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="createAdminBtn"
                        class="btn btn-primary"
                        style="background-color: #3b4ba0; border-color: #3b4ba0; border-radius: 5px;"
                        onmouseover="this.style.backgroundColor='white';this.style.color='#3b4ba0';this.style.border='1px solid #3b4ba0'"
                        onmouseout="this.style.backgroundColor='#3b4ba0';this.style.color='white';this.style.border='1px solid #3b4ba0'">
                    Create
                </button>
            </div>
        </div>
    </div>
</div>


<!-- Second Modal (Copy of the first with new ID) -->
<div class="modal fade" id="editAdminModal" tabindex="-1" aria-labelledby="editAdminModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editAdminModalLabel">Edit Appointment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="editAdminName" placeholder=" " required>
                        <label for="editAdminName">Patient Name</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="editAdminAge" placeholder=" " required>
                        <label for="editAdminAge">Age</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="date" class="form-control" id="editAdminDate" placeholder=" " required>
                        <label for="editAdminDate">Date</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="time" class="form-control" id="editAdminTime" placeholder=" " required>
                        <label for="editAdminTime">Time</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="editAdminDoctorName" placeholder=" " required>
                        <label for="editAdminName">Doctor Name</label>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button"
                        class="btn btn-primary"
                        style="background-color: #3b4ba0; border-color: #3b4ba0; border-radius: 5px;"
                        onmouseover="this.style.backgroundColor='white';this.style.color='#3b4ba0';this.style.border='1px solid #3b4ba0'"
                        onmouseout="this.style.backgroundColor='#3b4ba0';this.style.color='white';this.style.border='1px solid #3b4ba0'">
                    Save
                </button>
            </div>
        </div>
    </div>
</div>


<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Load the layout.html content
    fetch('layout.html')
        .then(response => response.text())
        .then(data => {
            document.getElementById('layout-container').innerHTML = data;
            updateScale();

            // Highlight admin menu
            const adminMenu = document.querySelector('.appointment-menu');
            if (adminMenu) {
                adminMenu.style.backgroundColor = '#3b4ba0';
                adminMenu.querySelector('.menu-text').style.color = '#fff';
            }

            // Get the modal instance
            const newAdminModal = new bootstrap.Modal(document.getElementById('newAdminModal'));

            // Add click event to New Admin button
            const newAdminBtn = document.querySelector('.group-child');
            if (newAdminBtn) {
                newAdminBtn.addEventListener('click', function() {
                    newAdminModal.show();
                });
            }

// Get the modal instance
            const editAdminModal = new bootstrap.Modal(document.getElementById('editAdminModal'));

            // Add click event to New Admin button
            const editAdminBtn = document.querySelector('.group-child2');
            if (editAdminBtn) {
                editAdminBtn.addEventListener('click', function() {
                    editAdminModal.show();
                });
            }


            // Adjust scaling for content
            const contentContainer = document.getElementById('content-container');
            const scale = window.innerWidth / 1920;
            contentContainer.style.transform = `scale(${scale})`;
            contentContainer.style.transformOrigin = 'top left';
        })
        .catch(error => console.error('Error loading layout:', error));

    function updateScale() {
        const container = document.querySelector('.scaling-container');
        if (container) {
            const scale = window.innerWidth / 1920;
            container.style.setProperty('--scale-factor', scale);
            document.body.style.height = `${868 * scale}px`;
        }
    }

    window.addEventListener('resize', updateScale);
    document.addEventListener('wheel', function(e) {
        if (e.ctrlKey) e.preventDefault();
    }, { passive: false });
</script>

<script>
    // Real-time validation for patient appointment form
    document.addEventListener('DOMContentLoaded', function() {
        // Get form elements
        const patientName = document.getElementById('adminName');
        const patientAge = document.getElementById('adminAge');
        const appointmentDate = document.getElementById('adminDate');
        const appointmentTime = document.getElementById('adminTime');
        const doctorName = document.getElementById('adminDoctorName');
        const createBtn = document.getElementById('createAdminBtn');

        // Create error message elements
        const createErrorElement = (input) => {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'invalid-feedback';
            input.parentNode.appendChild(errorDiv);
            return errorDiv;
        };

        const nameError = createErrorElement(patientName);
        const ageError = createErrorElement(patientAge);
        const dateError = createErrorElement(appointmentDate);
        const timeError = createErrorElement(appointmentTime);
        const doctorError = createErrorElement(doctorName);

        // Validation functions
        const validateName = () => {
            const value = patientName.value.trim();
            if (value.length < 3 || value.length > 50 || !/^[A-Za-z ]+$/.test(value)) {
                patientName.classList.add('is-invalid');
                nameError.textContent = 'Name must be 3-50 alphabetic characters';
                return false;
            }
            patientName.classList.remove('is-invalid');
            return true;
        };

        const validateAge = () => {
            const value = patientAge.value.trim();
            if (!/^\d{1,3}$/.test(value) || parseInt(value) < 1 || parseInt(value) > 120) {
                patientAge.classList.add('is-invalid');
                ageError.textContent = 'Age must be between 1-120 years';
                return false;
            }
            patientAge.classList.remove('is-invalid');
            return true;
        };

        const validateDate = () => {
            const value = appointmentDate.value;
            if (!value) {
                appointmentDate.classList.add('is-invalid');
                dateError.textContent = 'Please select a valid date';
                return false;
            }

            const selectedDate = new Date(value);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            if (selectedDate < today) {
                appointmentDate.classList.add('is-invalid');
                dateError.textContent = 'Date cannot be in the past';
                return false;
            }

            appointmentDate.classList.remove('is-invalid');
            return true;
        };

        const validateTime = () => {
            const value = appointmentTime.value;
            if (!value) {
                appointmentTime.classList.add('is-invalid');
                timeError.textContent = 'Please select a valid time';
                return false;
            }

            // Additional time validation if needed
            const [hours, minutes] = value.split(':');
            if (hours < 8 || hours > 20) {
                appointmentTime.classList.add('is-invalid');
                timeError.textContent = 'Appointments available between 8 AM - 8 PM';
                return false;
            }

            appointmentTime.classList.remove('is-invalid');
            return true;
        };

        const validateDoctorName = () => {
            const value = doctorName.value.trim();
            if (value.length < 3 || value.length > 50 || !/^[A-Za-z ]+$/.test(value)) {
                doctorName.classList.add('is-invalid');
                doctorError.textContent = 'Doctor name must be 3-50 alphabetic characters';
                return false;
            }
            doctorName.classList.remove('is-invalid');
            return true;
        };

        // Add event listeners for real-time validation
        patientName.addEventListener('input', validateName);
        patientAge.addEventListener('input', validateAge);
        appointmentDate.addEventListener('input', validateDate);
        appointmentTime.addEventListener('input', validateTime);
        doctorName.addEventListener('input', validateDoctorName);

        // Add event listener for form submission
        createBtn.addEventListener('click', function(e) {
            // Run all validations
            const isNameValid = validateName();
            const isAgeValid = validateAge();
            const isDateValid = validateDate();
            const isTimeValid = validateTime();
            const isDoctorValid = validateDoctorName();

            // If any validation fails, prevent form submission
            if (!isNameValid || !isAgeValid || !isDateValid || !isTimeValid || !isDoctorValid) {
                e.preventDefault();
                // Focus on first invalid field
                if (!isNameValid) patientName.focus();
                else if (!isAgeValid) patientAge.focus();
                else if (!isDateValid) appointmentDate.focus();
                else if (!isTimeValid) appointmentTime.focus();
                else if (!isDoctorValid) doctorName.focus();
            }
        });
    });
</script>

<script>
    // Real-time validation for edit patient appointment form
    document.addEventListener('DOMContentLoaded', function() {
        // Get edit form elements
        const editPatientName = document.getElementById('editAdminName');
        const editPatientAge = document.getElementById('editAdminAge');
        const editAppointmentDate = document.getElementById('editAdminDate');
        const editAppointmentTime = document.getElementById('editAdminTime');
        const editDoctorName = document.getElementById('editAdminDoctorName');
        const editSaveBtn = document.querySelector('#editAdminModal .btn-primary');

        // Create error message elements for edit form
        const createEditErrorElement = (input) => {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'invalid-feedback';
            input.parentNode.appendChild(errorDiv);
            return errorDiv;
        };

        const editNameError = createEditErrorElement(editPatientName);
        const editAgeError = createEditErrorElement(editPatientAge);
        const editDateError = createEditErrorElement(editAppointmentDate);
        const editTimeError = createEditErrorElement(editAppointmentTime);
        const editDoctorError = createEditErrorElement(editDoctorName);

        // Validation functions (same as create form)
        const validateEditName = () => {
            const value = editPatientName.value.trim();
            if (value.length < 3 || value.length > 50 || !/^[A-Za-z ]+$/.test(value)) {
                editPatientName.classList.add('is-invalid');
                editNameError.textContent = 'Name must be 3-50 alphabetic characters';
                return false;
            }
            editPatientName.classList.remove('is-invalid');
            return true;
        };

        const validateEditAge = () => {
            const value = editPatientAge.value.trim();
            if (!/^\d{1,3}$/.test(value) || parseInt(value) < 1 || parseInt(value) > 120) {
                editPatientAge.classList.add('is-invalid');
                editAgeError.textContent = 'Age must be between 1-120 years';
                return false;
            }
            editPatientAge.classList.remove('is-invalid');
            return true;
        };

        const validateEditDate = () => {
            const value = editAppointmentDate.value;
            if (!value) {
                editAppointmentDate.classList.add('is-invalid');
                editDateError.textContent = 'Please select a valid date';
                return false;
            }

            const selectedDate = new Date(value);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            if (selectedDate < today) {
                editAppointmentDate.classList.add('is-invalid');
                editDateError.textContent = 'Date cannot be in the past';
                return false;
            }

            editAppointmentDate.classList.remove('is-invalid');
            return true;
        };

        const validateEditTime = () => {
            const value = editAppointmentTime.value;
            if (!value) {
                editAppointmentTime.classList.add('is-invalid');
                editTimeError.textContent = 'Please select a valid time';
                return false;
            }

            // Additional time validation if needed
            const [hours, minutes] = value.split(':');
            if (hours < 8 || hours > 20) {
                editAppointmentTime.classList.add('is-invalid');
                editTimeError.textContent = 'Appointments available between 8 AM - 8 PM';
                return false;
            }

            editAppointmentTime.classList.remove('is-invalid');
            return true;
        };

        const validateEditDoctorName = () => {
            const value = editDoctorName.value.trim();
            if (value.length < 3 || value.length > 50 || !/^[A-Za-z ]+$/.test(value)) {
                editDoctorName.classList.add('is-invalid');
                editDoctorError.textContent = 'Doctor name must be 3-50 alphabetic characters';
                return false;
            }
            editDoctorName.classList.remove('is-invalid');
            return true;
        };

        // Add event listeners for real-time validation
        editPatientName.addEventListener('input', validateEditName);
        editPatientAge.addEventListener('input', validateEditAge);
        editAppointmentDate.addEventListener('input', validateEditDate);
        editAppointmentTime.addEventListener('input', validateEditTime);
        editDoctorName.addEventListener('input', validateEditDoctorName);

        // Add event listener for form submission
        editSaveBtn.addEventListener('click', function(e) {
            // Run all validations
            const isNameValid = validateEditName();
            const isAgeValid = validateEditAge();
            const isDateValid = validateEditDate();
            const isTimeValid = validateEditTime();
            const isDoctorValid = validateEditDoctorName();

            // If any validation fails, prevent form submission
            if (!isNameValid || !isAgeValid || !isDateValid || !isTimeValid || !isDoctorValid) {
                e.preventDefault();
                // Focus on first invalid field
                if (!isNameValid) editPatientName.focus();
                else if (!isAgeValid) editPatientAge.focus();
                else if (!isDateValid) editAppointmentDate.focus();
                else if (!isTimeValid) editAppointmentTime.focus();
                else if (!isDoctorValid) editDoctorName.focus();
            }
        });
    });
</script>


<script>
    document.getElementById('createAdminBtn').addEventListener('click', async () => {
        // Get form data
        const adminData = {
            patientName: document.getElementById('adminName').value,
            time: document.getElementById('adminTime').value,
            date: document.getElementById('adminDate').value,
            doctorName: document.getElementById('adminDoctorName').value,
            age: document.getElementById('adminAge').value
        };

        // UI feedback while processing
        const submitBtn = document.getElementById('createAdminBtn');
        const originalBtnText = submitBtn.innerHTML;
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status"></span> Processing...';

        try {
            // Add timeout to prevent hanging
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 10000);

            const response = await fetch('http://localhost:8080/api/appointments', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Basic ' + btoa('admin:admin')
                },
                body: JSON.stringify(adminData),
                credentials: 'include',
                signal: controller.signal,
                mode: 'cors'
            });

            clearTimeout(timeoutId);

            if (!response.ok) {
                let errorDetails;
                try {
                    errorDetails = await response.json();
                } catch {
                    errorDetails = { message: await response.text() };
                }
                throw new Error(errorDetails.message || `Server responded with ${response.status}`);
            }

            const result = await response.json();

            // Show success message
            const successAlert = document.createElement('div');
            successAlert.className = 'alert alert-success alert-dismissible fade show';
            successAlert.innerHTML = `
      Appointment created successfully!
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
            document.body.appendChild(successAlert);

            // Close modal and reset form
            const modal = bootstrap.Modal.getInstance(document.getElementById('newAdminModal'));
            if (modal) modal.hide();
            document.querySelector('#newAdminModal form').reset();

            // Refresh the admin table (NEW CODE)
            await loadAdmins(); // Call the same function that loads the table initially

        } catch (error) {
            console.error('Full error:', error);
            if (error.name === 'AbortError') {
                alert('Request timed out. The server is taking too long to respond.');
                return;
            }
            if (error.message.includes('Failed to fetch')) {
                alert(`Connection error. Please check:
1. The backend server is running
2. No browser extensions are blocking requests
3. You're using the correct URL (currently: http://localhost:8080)
4. Try in Incognito mode`);
                return;
            }
            alert(`Error: ${error.message}`);
        } finally {
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalBtnText;
        }
    });
</script>


<script>
    // Make loadAdmins globally available
    window.loadAdmins = async function() {
        try {
            // Show loading state
            const tbody = document.querySelector('.custom-admin-table tbody');
            tbody.innerHTML = '<tr><td colspan="4" class="text-center py-4"><div class="spinner-border text-primary" role="status"></div></tr>';

            const response = await fetch('http://localhost:8080/api/appointments', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Basic ' + btoa('admin:admin')
                },
                credentials: 'include',
                mode: 'cors'
            });

            if (!response.ok) {
                throw new Error(`Server responded with ${response.status}`);
            }

            const admins = await response.json();
            renderAdminTable(admins);
        } catch (error) {
            console.error('Error fetching doctors:', error);
            const tbody = document.querySelector('.custom-admin-table tbody');
            tbody.innerHTML = `<tr><td colspan="4" class="text-center text-danger">Failed to load data: ${error.message}</td></tr>`;
        }
    }

    function renderAdminTable(admins) {
        const tbody = document.querySelector('.custom-admin-table tbody');
        tbody.innerHTML = ''; // Clear existing rows

        if (admins.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" class="text-center">No appointments found</td></tr>';
            return;
        }

        admins.forEach(admin => {
            const row = document.createElement('tr');
            row.innerHTML = `
            <td>${admin.patientName}</td>
            <td>${admin.age}</td>
            <td>${admin.date}</td>
            <td>${admin.time}</td>
            <td>${admin.doctorName}</td>
            <td class="text-end">
                <div class="action-buttons">
                    <div class="group-child2" onclick="editAdmin(${admin.appointmentId})">
                        <img class="pencil-fill-icon" alt="Edit" src="/static/images/pencil-fill.svg">
                    </div>
                    <div class="group-child1" onclick="deleteAdmin(${admin.appointmentId})">
                        <img class="layer-2-icon" alt="Delete" src="/static/images/Layer 2.svg">
                    </div>
                </div>
            </td>
        `;
            tbody.appendChild(row);
        });
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', loadAdmins);

    // Placeholder functions for edit/delete
    window.editAdmin = function(appointmentId) {
        console.log('Edit appointment with ID:', appointmentId);
        // Implement edit functionality
    }

    window.deleteAdmin = function(appointmentId) {
        if (confirm('Are you sure you want to delete this doctor?')) {
            fetch(`http://localhost:8080/api/appointments/${appointmentId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': 'Basic ' + btoa('admin:admin')
                }
            })
                .then(response => {
                    if (!response.ok) throw new Error('Delete failed');
                    return loadAdmins(); // Refresh table after delete
                })
                .catch(error => {
                    console.error('Delete error:', error);
                    alert('Failed to delete appointment');
                });
        }
    }
</script>

<script>
    // Global variable to store current admin being edited
    let currentEditAdminId = null;

    // Update your editAdmin function
    window.editAdmin = function(appointmentId) {
        currentEditAdminId = appointmentId;

        // Fetch admin details
        fetch(`http://localhost:8080/api/appointments/${appointmentId}`, {
            method: 'GET',
            headers: {
                'Authorization': 'Basic ' + btoa('admin:admin')
            }
        })
            .then(response => {
                if (!response.ok) throw new Error('Failed to fetch appointment details');
                return response.json();
            })
            .then(admin => {
                // Populate modal fields
                document.getElementById('editAdminName').value = admin.patientName;
                document.getElementById('editAdminDate').value = admin.date;
                document.getElementById('editAdminTime').value = admin.time;
                document.getElementById('editAdminAge').value = admin.age;
                document.getElementById('editAdminDoctorName').value = admin.doctorName;


                // Show modal
                const editModal = new bootstrap.Modal(document.getElementById('editAdminModal'));
                editModal.show();
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to load appointment details: ' + error.message);
            });
    }

    // Add save functionality
    document.querySelector('#editAdminModal .btn-primary').addEventListener('click', async function() {
        const saveBtn = this;
        const originalBtnText = saveBtn.innerHTML;

        try {
            // UI feedback
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Saving...';

            // Get updated data
            const updatedAdmin = {
                patientName: document.getElementById('editAdminName').value,
                date: document.getElementById('editAdminDate').value,
                time: document.getElementById('editAdminTime').value,
                age: document.getElementById('editAdminAge').value,
                doctorName: document.getElementById('editAdminDoctorName').value,

                // Only send if changed
            };

            // Send update request
            const response = await fetch(`http://localhost:8080/api/appointments/${currentEditAdminId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Basic ' + btoa('admin:admin')
                },
                body: JSON.stringify(updatedAdmin)
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.message || 'Update failed');
            }

            // Success - refresh table and close modal
            await loadAdmins();
            bootstrap.Modal.getInstance(document.getElementById('editAdminModal')).hide();

            // Show success message
            const successAlert = document.createElement('div');
            successAlert.className = 'alert alert-success alert-dismissible fade show';
            successAlert.innerHTML = `
            appointment updated successfully!
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
            document.body.appendChild(successAlert);

        } catch (error) {
            console.error('Update error:', error);
            alert('Failed to update appointment: ' + error.message);
        } finally {
            saveBtn.disabled = false;
            saveBtn.innerHTML = originalBtnText;
        }
    });
</script>

</body>
</html>
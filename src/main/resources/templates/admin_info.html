<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin Information</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Otomanopee+One:wght@400&display=swap">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <style>
        #content-container {
            position: relative;
            z-index: 1;
            margin-left: 340px;
            width: calc(100% - 340px);
            height: 100%;
        }

        .layout-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        body {
            margin: 0;
            line-height: normal;
        }

        :root {
            /* Fonts */
            --font-poppins: Poppins;

            /* font sizes */
            --font-size-base: 16px;

            /* Colors */
            --color-black: #000;
            --color-darkslateblue: #3b4ba0;
            --color-tomato: #f55548;
            --color-white: #fff;

            /* Border radiuses */
            --br-5xs: 8px;
        }

        .group-child {
            position: absolute;
            top: 0px;
            left: 0px;
            border-radius: 5px;
            background-color: var(--color-darkslateblue);
            width: 154px;
            height: 41px;
            cursor: pointer;
        }
        .group-child:hover {
            background-color: var(--color-white);
            border: 1px solid var(--color-darkslateblue);
            color: var(--color-darkslateblue);
        }

        .fi-sr-plus-small-icon {
            position: absolute;
            height: 68.78%;
            width: 18.31%;
            top: 15.63%;
            right: 77.49%;
            bottom: 15.59%;
            left: 4.2%;
            max-width: 100%;
            overflow: hidden;
            max-height: 100%;
        }
        .group-child:hover .fi-sr-plus-small-icon {
            filter: brightness(0) saturate(100%) invert(26%) sepia(89%) saturate(748%) hue-rotate(197deg) brightness(89%) contrast(91%);
        }
        .sumanth-tinson {
            position: absolute;
            top: 21.88%;
            left: 25%;
        }
        .rectangle-parent {
            position: absolute;
            top: 0px;
            left: 1251px;
            width: 154px;
            height: 41px;
        }
        .patients {
            position: absolute;
            top: 0%;
            left: 0%;
        }
        .patients-wrapper {
            position: absolute;
            height: 87.8%;
            width: 9.25%;
            top: 0%;
            right: 90.75%;
            bottom: 12.2%;
            left: 0%;
            font-size: 24px;
            color: var(--color-black);
        }
        .group-container {
            position: absolute;
            top: 0px;
            left: 0px;
            width: 1405px;
            height: 41px;
        }

        /* New Table Styles */
        .custom-admin-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background-color: var(--color-white);
        }

        .custom-admin-table thead th {
            background-color: transparent;
            border-bottom: 1px solid var(--color-black);

            padding: 15px;
            font-weight: bold;
            color: var(--color-black);
        }

        .custom-admin-table tbody tr {
            height: 65px;
            border-bottom: 1px solid var(--color-black);
        }

        .custom-admin-table tbody td {
            padding: 15px;
            vertical-align: middle;
            border-bottom: 1px solid var(--color-black);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 20px;

        }

        .group-child1, .group-child2 {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 38px;
            height: 38px;
            border-radius: var(--br-5xs);
            cursor: pointer;
        }

        .group-child1 {
            background-color: var(--color-tomato);
        }
        .group-child1:hover {
            background-color: #CF4438 !important;
        }

        .group-child2 {
            background-color: var(--color-darkslateblue);
        }
        .group-child2:hover {
            background-color: #2C387A !important;
        }

        .pencil-fill-icon {
            width: 16px;
            height: 16px;
        }

         .layer-2-icon{
               width: 25px;
               height: 25px;
         }

        .rectangle-group {
            position: absolute;
            top: 117px;
            left: 0px;
            width: 1405px;
            height: 230px;
            color: var(--color-black);
        }

        .group-parent {
            width: 100%;
            position: relative;
            height: 347px;
            text-align: left;
            font-size: var(--font-size-base);
            color: var(--color-white);
            font-family: var(--font-poppins);
            top: 100px;
        }
    </style>
</head>
<body>

<!-- Layout container (fixed position) -->
<div id="layout-container" class="layout-container"></div>

<!-- Content container (positioned next to sidebar) -->
<div id="content-container">
    <div class="scaling-container">
        <div class="group-parent">
            <div class="group-container">
                <div class="rectangle-parent">
                    <div class="group-child">
                        <img class="fi-sr-plus-small-icon" alt="" src="/static/images/fi-sr-plus-small.svg">
                        <div class="sumanth-tinson">New Admin</div>
                    </div>
                </div>
                <div class="patients-wrapper">
                    <div class="patients">Admin Info</div>
                </div>
            </div>

            <!-- Updated Table Structure -->
            <div class="rectangle-group">
                <div class="table-responsive">
                    <table class="table table-borderless custom-admin-table">
                        <thead>
                        <tr>
                            <th style="width: 20%">Admin Name</th>
                            <th style="width: 15%">Phone Number</th>
                            <th style="width: 20%">Email</th>
                            <th style="width: 10%" >Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- Row 1 -->
                        <tr>
                            <td>Piumal Fernando</td>
                            <td>0775688755</td>
                            <td>example@gmail.com</td>
                            <td class="text-end">
                                <div class="action-buttons">
                                    <div class="group-child2">
                                        <img class="pencil-fill-icon" alt="Edit" src="/static/images/pencil-fill.svg">
                                    </div>
                                    <div class="group-child1">
                                        <img class="layer-2-icon" alt="Delete" src="/static/images/Layer%202.svg">
                                    </div>
                                </div>
                            </td>
                        </tr>

                        <!-- Row 2 -->
                        <tr>
                            <td>Hasith Madhushan</td>
                            <td>0775688755</td>
                            <td>example@gmail.com</td>
                            <td class="text-end">
                                <div class="action-buttons">
                                    <div class="group-child2">
                                        <img class="pencil-fill-icon" alt="Edit" src="/static/images/pencil-fill.svg">
                                    </div>
                                    <div class="group-child1">
                                        <img class="layer-2-icon" alt="Delete" src="/static/images/Layer%202.svg">
                                    </div>
                                </div>
                            </td>
                        </tr>

                        <!-- Row 3 -->
                        <tr>
                            <td>Chathura De Silva</td>
                            <td>0775688755</td>
                            <td>example@gmail.com</td>
                            <td class="text-end">
                                <div class="action-buttons">
                                    <div class="group-child2">
                                        <img class="pencil-fill-icon" alt="Edit" src="/static/images/pencil-fill.svg">
                                    </div>
                                    <div class="group-child1">
                                        <img class="layer-2-icon" alt="Delete" src="/static/images/Layer%202.svg">
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap Modal -->
<div class="modal fade" id="newAdminModal" tabindex="-1" aria-labelledby="newAdminModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="newAdminModalLabel">New Admin</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="adminName" placeholder=" " required>
                        <label for="adminName">Admin Name</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="email" class="form-control" id="adminEmail" placeholder=" " required>
                        <label for="adminEmail">Email</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="tel" class="form-control" id="adminPhone" placeholder=" " required>
                        <label for="adminPhone">Phone Number</label>
                    </div>
                    <div class="form-floating mb-3 position-relative">
                        <input type="password" class="form-control" id="adminPassword" placeholder=" " required>
                        <label for="adminPassword">Password</label>
                        <button type="button" class="btn btn-link position-absolute end-0 top-50 translate-middle-y me-2"
                                id="togglePassword"
                                style="z-index: 10; padding: 0.375rem;">
                            <i class="bi bi-eye-slash"></i>
                        </button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="createAdminBtn"
                        class="btn btn-primary"
                        style="background-color: #3b4ba0; border-color: #3b4ba0; border-radius: 5px;"
                        onmouseover="this.style.backgroundColor='white';this.style.color='#3b4ba0';this.style.border='1px solid #3b4ba0'"
                        onmouseout="this.style.backgroundColor='#3b4ba0';this.style.color='white';this.style.border='1px solid #3b4ba0'">
                    Create
                </button>
            </div>
        </div>
    </div>
</div>


<!-- Second Modal (Copy of the first with new ID) -->
<div class="modal fade" id="editAdminModal" tabindex="-1" aria-labelledby="editAdminModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editAdminModalLabel">Edit Admin</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="editAdminName" placeholder=" " required>
                        <label for="editAdminName">Admin Name</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="email" class="form-control" id="editAdminEmail" placeholder=" " required>
                        <label for="editAdminEmail">Email</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="tel" class="form-control" id="editAdminPhone" placeholder=" " required>
                        <label for="editAdminPhone">Phone Number</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="password" class="form-control" id="editAdminPassword" placeholder=" " required>
                        <label for="editAdminPassword">Password</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button"
                        class="btn btn-primary"
                        style="background-color: #3b4ba0; border-color: #3b4ba0; border-radius: 5px;"
                        onmouseover="this.style.backgroundColor='white';this.style.color='#3b4ba0';this.style.border='1px solid #3b4ba0'"
                        onmouseout="this.style.backgroundColor='#3b4ba0';this.style.color='white';this.style.border='1px solid #3b4ba0'">
                    Save
                </button>
            </div>
        </div>
    </div>
</div>




<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Load the layout.html content
    fetch('layout.html')
        .then(response => response.text())
        .then(data => {
            document.getElementById('layout-container').innerHTML = data;
            updateScale();

            // Highlight admin menu
            const adminMenu = document.querySelector('.admin-menu');
            if (adminMenu) {
                adminMenu.style.backgroundColor = '#3b4ba0';
                adminMenu.querySelector('.menu-text').style.color = '#fff';
            }

            // Get the modal instance
            const newAdminModal = new bootstrap.Modal(document.getElementById('newAdminModal'));

            // Add click event to New Admin button
            const newAdminBtn = document.querySelector('.group-child');
            if (newAdminBtn) {
                newAdminBtn.addEventListener('click', function() {
                    newAdminModal.show();
                });
            }

// Get the modal instance
            const editAdminModal = new bootstrap.Modal(document.getElementById('editAdminModal'));

            // Add click event to New Admin button
            const editAdminBtn = document.querySelector('.group-child2');
            if (editAdminBtn) {
                editAdminBtn.addEventListener('click', function() {
                    editAdminModal.show();
                });
            }


            // Adjust scaling for content
            const contentContainer = document.getElementById('content-container');
            const scale = window.innerWidth / 1920;
            contentContainer.style.transform = `scale(${scale})`;
            contentContainer.style.transformOrigin = 'top left';
        })
        .catch(error => console.error('Error loading layout:', error));

    function updateScale() {
        const container = document.querySelector('.scaling-container');
        if (container) {
            const scale = window.innerWidth / 1920;
            container.style.setProperty('--scale-factor', scale);
            document.body.style.height = `${868 * scale}px`;
        }
    }

    window.addEventListener('resize', updateScale);
    document.addEventListener('wheel', function(e) {
        if (e.ctrlKey) e.preventDefault();
    }, { passive: false });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
    // Password visibility toggle
    const togglePassword = document.getElementById('togglePassword');
    const adminPassword = document.getElementById('adminPassword');
    const icon = togglePassword.querySelector('i');

    togglePassword.addEventListener('click', function() {
        const type = adminPassword.getAttribute('type') === 'password' ? 'text' : 'password';
        adminPassword.setAttribute('type', type);

        // Toggle between eye and eye-slash icons
        if (type === 'password') {
            icon.classList.remove('bi-eye');
            icon.classList.add('bi-eye-slash');
        } else {
            icon.classList.remove('bi-eye-slash');
            icon.classList.add('bi-eye');
        }
    });

    // Get other form elements
    const adminName = document.getElementById('adminName');
    const adminEmail = document.getElementById('adminEmail');
    const adminPhone = document.getElementById('adminPhone');

    // Create error message elements
    const createErrorElement = (input) => {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'invalid-feedback';
        input.parentNode.appendChild(errorDiv);
        return errorDiv;
    };

    const nameError = createErrorElement(adminName);
    const emailError = createErrorElement(adminEmail);
    const phoneError = createErrorElement(adminPhone);
    const passwordError = createErrorElement(adminPassword);

    // Validation functions
    const validateName = () => {
        const value = adminName.value.trim();
        if (value.length < 3 || value.length > 50 || !/^[A-Za-z ]+$/.test(value)) {
            adminName.classList.add('is-invalid');
            nameError.textContent = 'Name must be 3-50 alphabetic characters';
            return false;
        }
        adminName.classList.remove('is-invalid');
        return true;
    };

    const validateEmail = () => {
        const value = adminEmail.value.trim();
        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
            adminEmail.classList.add('is-invalid');
            emailError.textContent = 'Please enter a valid email address';
            return false;
        }
        adminEmail.classList.remove('is-invalid');
        return true;
    };

    const validatePhone = () => {
        const value = adminPhone.value.trim();
        if (!/^\d{10}$/.test(value)) {
            adminPhone.classList.add('is-invalid');
            phoneError.textContent = 'Phone number must be 10 digits';
            return false;
        }
        adminPhone.classList.remove('is-invalid');
        return true;
    };

    const validatePassword = () => {
        const value = adminPassword.value;
        if (!/(?=.*[A-Za-z])(?=.*\d).{8,}/.test(value)) {
            adminPassword.classList.add('is-invalid');
            passwordError.textContent = 'Password must be 8+ chars with at least one letter and one number';
            return false;
        }
        adminPassword.classList.remove('is-invalid');
        return true;
    };

    // Add event listeners for real-time validation
    adminName.addEventListener('input', validateName);
    adminEmail.addEventListener('input', validateEmail);
    adminPhone.addEventListener('input', function() {
        this.value = this.value.replace(/\D/g, '').substring(0, 10);
        validatePhone();
    });
    adminPassword.addEventListener('input', validatePassword);

    // Add event listener for form submission
    document.getElementById('createAdminBtn').addEventListener('click', function(e) {
        // Run all validations
        const isNameValid = validateName();
        const isEmailValid = validateEmail();
        const isPhoneValid = validatePhone();
        const isPasswordValid = validatePassword();

        // If any validation fails, prevent form submission
        if (!isNameValid || !isEmailValid || !isPhoneValid || !isPasswordValid) {
            e.preventDefault();
            // Focus on first invalid field
            if (!isNameValid) adminName.focus();
            else if (!isEmailValid) adminEmail.focus();
            else if (!isPhoneValid) adminPhone.focus();
            else if (!isPasswordValid) adminPassword.focus();
        }
    });
});
</script>


<script>
    // Real-time validation for edit admin form
document.addEventListener('DOMContentLoaded', function() {
    // Get edit form elements
    const editAdminName = document.getElementById('editAdminName');
    const editAdminEmail = document.getElementById('editAdminEmail');
    const editAdminPhone = document.getElementById('editAdminPhone');
    const editAdminPassword = document.getElementById('editAdminPassword');
    const editAdminBtn = document.querySelector('#editAdminModal .btn-primary');

    // Create error message elements for edit form
    const createEditErrorElement = (input) => {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'invalid-feedback';
        input.parentNode.appendChild(errorDiv);
        return errorDiv;
    };

    const editNameError = createEditErrorElement(editAdminName);
    const editEmailError = createEditErrorElement(editAdminEmail);
    const editPhoneError = createEditErrorElement(editAdminPhone);
    const editPasswordError = createEditErrorElement(editAdminPassword);

    // Validation functions (same as create form)
    const validateEditName = () => {
        const value = editAdminName.value.trim();
        if (value.length < 3 || value.length > 50 || !/^[A-Za-z ]+$/.test(value)) {
            editAdminName.classList.add('is-invalid');
            editNameError.textContent = 'Name must be 3-50 alphabetic characters';
            return false;
        }
        editAdminName.classList.remove('is-invalid');
        return true;
    };

    const validateEditEmail = () => {
        const value = editAdminEmail.value.trim();
        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
            editAdminEmail.classList.add('is-invalid');
            editEmailError.textContent = 'Please enter a valid email address';
            return false;
        }
        editAdminEmail.classList.remove('is-invalid');
        return true;
    };

    const validateEditPhone = () => {
        const value = editAdminPhone.value.trim();
        if (!/^\d{10}$/.test(value)) {
            editAdminPhone.classList.add('is-invalid');
            editPhoneError.textContent = 'Phone number must be 10 digits';
            return false;
        }
        editAdminPhone.classList.remove('is-invalid');
        return true;
    };

    const validateEditPassword = () => {
        const value = editAdminPassword.value;
        if (value && !/(?=.*[A-Za-z])(?=.*\d).{8,}/.test(value)) {
            editAdminPassword.classList.add('is-invalid');
            editPasswordError.textContent = 'Password must be 8+ chars with at least one letter and one number (leave empty to keep current)';
            return false;
        }
        editAdminPassword.classList.remove('is-invalid');
        return true;
    };

    // Add event listeners for real-time validation
    editAdminName.addEventListener('input', validateEditName);
    editAdminEmail.addEventListener('input', validateEditEmail);
    editAdminPhone.addEventListener('input', validateEditPhone);
    editAdminPassword.addEventListener('input', validateEditPassword);

    // Add event listener for form submission
    editAdminBtn.addEventListener('click', function(e) {
        // Run all validations
        const isNameValid = validateEditName();
        const isEmailValid = validateEditEmail();
        const isPhoneValid = validateEditPhone();
        const isPasswordValid = validateEditPassword();

        // If any validation fails, prevent form submission
        if (!isNameValid || !isEmailValid || !isPhoneValid || !isPasswordValid) {
            e.preventDefault();
            // Focus on first invalid field
            if (!isNameValid) editAdminName.focus();
            else if (!isEmailValid) editAdminEmail.focus();
            else if (!isPhoneValid) editAdminPhone.focus();
            else if (!isPasswordValid) editAdminPassword.focus();
        }
    });
});
</script>


<script>
    document.getElementById('createAdminBtn').addEventListener('click', async () => {
  // Get form data
  const adminData = {
    adminName: document.getElementById('adminName').value,
    email: document.getElementById('adminEmail').value,
    phoneNumber: document.getElementById('adminPhone').value,
    password: document.getElementById('adminPassword').value
  };

  // UI feedback while processing
  const submitBtn = document.getElementById('createAdminBtn');
  const originalBtnText = submitBtn.innerHTML;
  submitBtn.disabled = true;
  submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status"></span> Processing...';

  try {
    // Add timeout to prevent hanging
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 10000);

    const response = await fetch('http://localhost:8080/api/admins', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Basic ' + btoa('admin:admin')
      },
      body: JSON.stringify(adminData),
      credentials: 'include',
      signal: controller.signal,
      mode: 'cors'
    });

    clearTimeout(timeoutId);

    if (!response.ok) {
      let errorDetails;
      try {
        errorDetails = await response.json();
      } catch {
        errorDetails = { message: await response.text() };
      }
      throw new Error(errorDetails.message || `Server responded with ${response.status}`);
    }

    const result = await response.json();

    // Show success message
    const successAlert = document.createElement('div');
    successAlert.className = 'alert alert-success alert-dismissible fade show';
    successAlert.innerHTML = `
      Admin created successfully!
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    document.body.appendChild(successAlert);

    // Close modal and reset form
    const modal = bootstrap.Modal.getInstance(document.getElementById('newAdminModal'));
    if (modal) modal.hide();
    document.querySelector('#newAdminModal form').reset();

    // Refresh the admin table (NEW CODE)
    await loadAdmins(); // Call the same function that loads the table initially

  } catch (error) {
    console.error('Full error:', error);
    if (error.name === 'AbortError') {
      alert('Request timed out. The server is taking too long to respond.');
      return;
    }
    if (error.message.includes('Failed to fetch')) {
      alert(`Connection error. Please check:
1. The backend server is running
2. No browser extensions are blocking requests
3. You're using the correct URL (currently: http://localhost:8080)
4. Try in Incognito mode`);
      return;
    }
    alert(`Error: ${error.message}`);
  } finally {
    submitBtn.disabled = false;
    submitBtn.innerHTML = originalBtnText;
  }
});
</script>


<script>
    // Make loadAdmins globally available
window.loadAdmins = async function() {
    try {
        // Show loading state
        const tbody = document.querySelector('.custom-admin-table tbody');
        tbody.innerHTML = '<tr><td colspan="4" class="text-center py-4"><div class="spinner-border text-primary" role="status"></div></tr>';

        const response = await fetch('http://localhost:8080/api/admins', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Basic ' + btoa('admin:admin')
            },
            credentials: 'include',
            mode: 'cors'
        });

        if (!response.ok) {
            throw new Error(`Server responded with ${response.status}`);
        }

        const admins = await response.json();
        renderAdminTable(admins);
    } catch (error) {
        console.error('Error fetching admins:', error);
        const tbody = document.querySelector('.custom-admin-table tbody');
        tbody.innerHTML = `<tr><td colspan="4" class="text-center text-danger">Failed to load data: ${error.message}</td></tr>`;
    }
}

function renderAdminTable(admins) {
    const tbody = document.querySelector('.custom-admin-table tbody');
    tbody.innerHTML = ''; // Clear existing rows

    if (admins.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="text-center">No admins found</td></tr>';
        return;
    }

    admins.forEach(admin => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${admin.adminName}</td>
            <td>${admin.phoneNumber}</td>
            <td>${admin.email}</td>
            <td class="text-end">
                <div class="action-buttons">
                    <div class="group-child2" onclick="editAdmin(${admin.adminId})">
                        <img class="pencil-fill-icon" alt="Edit" src="/static/images/pencil-fill.svg">
                    </div>
                    <div class="group-child1" onclick="deleteAdmin(${admin.adminId})">
                        <img class="layer-2-icon" alt="Delete" src="/static/images/Layer 2.svg">
                    </div>
                </div>
            </td>
        `;
        tbody.appendChild(row);
    });
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', loadAdmins);

// Placeholder functions for edit/delete
window.editAdmin = function(adminId) {
    console.log('Edit admin with ID:', adminId);
    // Implement edit functionality
}

window.deleteAdmin = function(adminId) {
    if (confirm('Are you sure you want to delete this admin?')) {
        fetch(`http://localhost:8080/api/admins/${adminId}`, {
            method: 'DELETE',
            headers: {
                'Authorization': 'Basic ' + btoa('admin:admin')
            }
        })
        .then(response => {
            if (!response.ok) throw new Error('Delete failed');
            return loadAdmins(); // Refresh table after delete
        })
        .catch(error => {
            console.error('Delete error:', error);
            alert('Failed to delete admin');
        });
    }
}
</script>

<script>
    // Global variable to store current admin being edited
let currentEditAdminId = null;

// Update your editAdmin function
window.editAdmin = function(adminId) {
    currentEditAdminId = adminId;

    // Fetch admin details
    fetch(`http://localhost:8080/api/admins/${adminId}`, {
        method: 'GET',
        headers: {
            'Authorization': 'Basic ' + btoa('admin:admin')
        }
    })
    .then(response => {
        if (!response.ok) throw new Error('Failed to fetch admin details');
        return response.json();
    })
    .then(admin => {
        // Populate modal fields
        document.getElementById('editAdminName').value = admin.adminName;
        document.getElementById('editAdminEmail').value = admin.email;
        document.getElementById('editAdminPhone').value = admin.phoneNumber;
        document.getElementById('editAdminPassword').value = ''; // Clear password field

        // Show modal
        const editModal = new bootstrap.Modal(document.getElementById('editAdminModal'));
        editModal.show();
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Failed to load admin details: ' + error.message);
    });
}

// Add save functionality
document.querySelector('#editAdminModal .btn-primary').addEventListener('click', async function() {
    const saveBtn = this;
    const originalBtnText = saveBtn.innerHTML;

    try {
        // UI feedback
        saveBtn.disabled = true;
        saveBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Saving...';

        // Get updated data
        const updatedAdmin = {
            adminName: document.getElementById('editAdminName').value,
            email: document.getElementById('editAdminEmail').value,
            phoneNumber: document.getElementById('editAdminPhone').value,
            password: document.getElementById('editAdminPassword').value || undefined // Only send if changed
        };

        // Send update request
        const response = await fetch(`http://localhost:8080/api/admins/${currentEditAdminId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Basic ' + btoa('admin:admin')
            },
            body: JSON.stringify(updatedAdmin)
        });

        if (!response.ok) {
            const error = await response.json();
            throw new Error(error.message || 'Update failed');
        }

        // Success - refresh table and close modal
        await loadAdmins();
        bootstrap.Modal.getInstance(document.getElementById('editAdminModal')).hide();

        // Show success message
        const successAlert = document.createElement('div');
        successAlert.className = 'alert alert-success alert-dismissible fade show';
        successAlert.innerHTML = `
            Admin updated successfully!
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        document.body.appendChild(successAlert);

    } catch (error) {
        console.error('Update error:', error);
        alert('Failed to update admin: ' + error.message);
    } finally {
        saveBtn.disabled = false;
        saveBtn.innerHTML = originalBtnText;
    }
});
</script>

</body>
</html>
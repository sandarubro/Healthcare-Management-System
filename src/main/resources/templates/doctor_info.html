<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Doctor Information</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Otomanopee+One:wght@400&display=swap">

    <style>
        #content-container {
            position: relative;
            z-index: 1;
            margin-left: 340px;
            width: calc(100% - 340px);
            height: 100%;
        }

        .layout-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        body {
            margin: 0;
            line-height: normal;
        }

        :root {
            /* Fonts */
            --font-poppins: Poppins;

            /* font sizes */
            --font-size-base: 16px;

            /* Colors */
            --color-black: #000;
            --color-darkslateblue: #3b4ba0;
            --color-tomato: #f55548;
            --color-white: #fff;

            /* Border radiuses */
            --br-5xs: 8px;
        }

        .group-child {
            position: absolute;
            top: 0px;
            left: 0px;
            border-radius: 5px;
            background-color: var(--color-darkslateblue);
            width: 154px;
            height: 41px;
            cursor: pointer;
        }
        .group-child:hover {
            background-color: var(--color-white);
            border: 1px solid var(--color-darkslateblue);
            color: var(--color-darkslateblue);
        }

        .fi-sr-plus-small-icon {
            position: absolute;
            height: 68.78%;
            width: 18.31%;
            top: 15.63%;
            right: 77.49%;
            bottom: 15.59%;
            left: 4.2%;
            max-width: 100%;
            overflow: hidden;
            max-height: 100%;
        }
        .group-child:hover .fi-sr-plus-small-icon {
            filter: brightness(0) saturate(100%) invert(26%) sepia(89%) saturate(748%) hue-rotate(197deg) brightness(89%) contrast(91%);
        }
        .sumanth-tinson {
            position: absolute;
            top: 21.88%;
            left: 25%;
        }
        .rectangle-parent {
            position: absolute;
            top: 0px;
            left: 1251px;
            width: 154px;
            height: 41px;
        }
        .patients {
            position: absolute;
            top: 0%;
            left: 0%;
        }
        .patients-wrapper {
            position: absolute;
            height: 87.8%;
            width: 9.25%;
            top: 0%;
            right: 90.75%;
            bottom: 12.2%;
            left: 0%;
            font-size: 24px;
            color: var(--color-black);
        }
        .group-container {
            position: absolute;
            top: 0px;
            left: 0px;
            width: 1405px;
            height: 41px;
        }

        /* New Table Styles */
        .custom-doctor-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background-color: var(--color-white);
        }

        .custom-doctor-table thead th {
            background-color: transparent;
            border-bottom: 1px solid var(--color-black);

            padding: 15px;
            font-weight: bold;
            color: var(--color-black);
        }

        .custom-doctor-table tbody tr {
            height: 65px;
            border-bottom: 1px solid var(--color-black);
        }

        .custom-doctor-table tbody td {
            padding: 15px;
            vertical-align: middle;
            border-bottom: 1px solid var(--color-black);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 20px;

        }

        .group-child1, .group-child2 {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 38px;
            height: 38px;
            border-radius: var(--br-5xs);
            cursor: pointer;
        }

        .group-child1 {
            background-color: var(--color-tomato);
        }
        .group-child1:hover {
            background-color: #CF4438 !important;
        }

        .group-child2 {
            background-color: var(--color-darkslateblue);
        }
        .group-child2:hover {
            background-color: #2C387A !important;
        }

        .pencil-fill-icon {
            width: 16px;
            height: 16px;
        }

         .layer-2-icon{
               width: 25px;
               height: 25px;
         }

        .rectangle-group {
            position: absolute;
            top: 117px;
            left: 0px;
            width: 1405px;
            height: 230px;
            color: var(--color-black);
        }

        .group-parent {
            width: 100%;
            position: relative;
            height: 347px;
            text-align: left;
            font-size: var(--font-size-base);
            color: var(--color-white);
            font-family: var(--font-poppins);
            top: 100px;
        }
    </style>
</head>
<body>

<!-- Layout container (fixed position) -->
<div id="layout-container" class="layout-container"></div>

<!-- Content container (positioned next to sidebar) -->
<div id="content-container">
    <div class="scaling-container">
        <div class="group-parent">
            <div class="group-container">
                <div class="rectangle-parent">
                    <div class="group-child">
                        <img class="fi-sr-plus-small-icon" alt="" src="/static/images/fi-sr-plus-small.svg">
                        <div class="sumanth-tinson">New Doctor</div>
                    </div>
                </div>
                <div class="patients-wrapper">
                    <div class="patients">Doctor Information</div>
                </div>
            </div>

            <!-- Updated Table Structure -->
            <div class="rectangle-group">
                <div class="table-responsive">
                    <table class="table table-borderless custom-doctor-table">
                        <thead>
                        <tr>
                            <th style="width: 20%">Doctor Name</th>
                            <th style="width: 20%">Specialization</th>
                            <th style="width: 15%">Phone Number</th>
                            <th style="width: 20%">Email</th>
                            <th style="width: 10%" >Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- Row 1 -->
                        <tr>
                            <td>Piumal Fernando</td>
                            <td>Cardiologist</td>
                            <td>0775688755</td>
                            <td>example@gmail.com</td>
                            <td class="text-end">
                                <div class="action-buttons">
                                    <div class="group-child2">
                                        <img class="pencil-fill-icon" alt="Edit" src="/static/images/pencil-fill.svg">
                                    </div>
                                    <div class="group-child1">
                                        <img class="layer-2-icon" alt="Delete" src="/static/images/Layer 2.svg">
                                    </div>
                                </div>
                            </td>
                        </tr>

                        <!-- Row 2 -->
                        <tr>
                            <td>Hasith Madhushan</td>
                            <td>Cardiologist</td>
                            <td>0775688755</td>
                            <td>example@gmail.com</td>
                            <td class="text-end">
                                <div class="action-buttons">
                                    <div class="group-child2">
                                        <img class="pencil-fill-icon" alt="Edit" src="/static/images/pencil-fill.svg">
                                    </div>
                                    <div class="group-child1">
                                        <img class="layer-2-icon" alt="Delete" src="/static/images/Layer 2.svg">
                                    </div>
                                </div>
                            </td>
                        </tr>

                        <!-- Row 3 -->
                        <tr>
                            <td>Chathura De Silva</td>
                            <td>Cardiologist</td>
                            <td>0775688755</td>
                            <td>example@gmail.com</td>
                            <td class="text-end">
                                <div class="action-buttons">
                                    <div class="group-child2">
                                        <img class="pencil-fill-icon" alt="Edit" src="/static/images/pencil-fill.svg">
                                    </div>
                                    <div class="group-child1">
                                        <img class="layer-2-icon" alt="Delete" src="/static/images/Layer 2.svg">
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap Modal -->
<div class="modal fade" id="newDoctorModal" tabindex="-1" aria-labelledby="newDoctorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="newDoctorModalLabel">New Doctor</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="doctorName" placeholder=" " required>
                        <label for="doctorName">Doctor Name</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="specialization" placeholder=" " required>
                        <label for="specialization">Specialization</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="email" class="form-control" id="doctorEmail" placeholder=" " required>
                        <label for="doctorEmail">Email</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="tel" class="form-control" id="doctorPhone" placeholder=" " required>
                        <label for="doctorPhone">Phone Number</label>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="createDoctorBtn"
                        class="btn btn-primary"
                        style="background-color: #3b4ba0; border-color: #3b4ba0; border-radius: 5px;"
                        onmouseover="this.style.backgroundColor='white';this.style.color='#3b4ba0';this.style.border='1px solid #3b4ba0'"
                        onmouseout="this.style.backgroundColor='#3b4ba0';this.style.color='white';this.style.border='1px solid #3b4ba0'">
                    Create
                </button>
            </div>
        </div>
    </div>
</div>


<!-- Second Modal (Copy of the first with new ID) -->
<div class="modal fade" id="editDoctorModal" tabindex="-1" aria-labelledby="editDoctorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editDoctorModalLabel">Edit Doctor</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="editDoctorName" placeholder=" " required>
                        <label for="editDoctorName">Doctor Name</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="editSpecialization" placeholder=" " required>
                        <label for="editSpecialization">Specialization</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="email" class="form-control" id="editDoctorEmail" placeholder=" " required>
                        <label for="editDoctorEmail">Email</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="tel" class="form-control" id="editDoctorPhone" placeholder=" " required>
                        <label for="editDoctorPhone">Phone Number</label>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button"
                        class="btn btn-primary"
                        style="background-color: #3b4ba0; border-color: #3b4ba0; border-radius: 5px;"
                        onmouseover="this.style.backgroundColor='white';this.style.color='#3b4ba0';this.style.border='1px solid #3b4ba0'"
                        onmouseout="this.style.backgroundColor='#3b4ba0';this.style.color='white';this.style.border='1px solid #3b4ba0'">
                    Save
                </button>
            </div>
        </div>
    </div>
</div>


<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Load the layout.html content
    fetch('layout.html')
        .then(response => response.text())
        .then(data => {
            document.getElementById('layout-container').innerHTML = data;
            updateScale();

            // Highlight doctor menu
            const doctorMenu = document.querySelector('.doctor-menu');
            if (doctorMenu) {
                doctorMenu.style.backgroundColor = '#3b4ba0';
                doctorMenu.querySelector('.menu-text').style.color = '#fff';
            }

            // Get the modal instance
            const newDoctorModal = new bootstrap.Modal(document.getElementById('newDoctorModal'));

            // Add click event to New Doctor button
            const newDoctorBtn = document.querySelector('.group-child');
            if (newDoctorBtn) {
                newDoctorBtn.addEventListener('click', function() {
                    newDoctorModal.show();
                });
            }

// Get the modal instance
            const editDoctorModal = new bootstrap.Modal(document.getElementById('editDoctorModal'));

            // Add click event to New Doctor button
            const editDoctorBtn = document.querySelector('.group-child2');
            if (editDoctorBtn) {
                editDoctorBtn.addEventListener('click', function() {
                    editDoctorModal.show();
                });
            }


            // Adjust scaling for content
            const contentContainer = document.getElementById('content-container');
            const scale = window.innerWidth / 1920;
            contentContainer.style.transform = `scale(${scale})`;
            contentContainer.style.transformOrigin = 'top left';
        })
        .catch(error => console.error('Error loading layout:', error));

    function updateScale() {
        const container = document.querySelector('.scaling-container');
        if (container) {
            const scale = window.innerWidth / 1920;
            container.style.setProperty('--scale-factor', scale);
            document.body.style.height = `${868 * scale}px`;
        }
    }

    window.addEventListener('resize', updateScale);
    document.addEventListener('wheel', function(e) {
        if (e.ctrlKey) e.preventDefault();
    }, { passive: false });
</script>


<script>
    document.getElementById('createDoctorBtn').addEventListener('click', async () => {
  // Get form data
  const doctorData = {
    doctorName: document.getElementById('doctorName').value,
    email: document.getElementById('doctorEmail').value,
    phoneNumber: document.getElementById('doctorPhone').value,
    password: document.getElementById('doctorPassword').value
  };

  // UI feedback while processing
  const submitBtn = document.getElementById('createDoctorBtn');
  const originalBtnText = submitBtn.innerHTML;
  submitBtn.disabled = true;
  submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status"></span> Processing...';

  try {
    // Add timeout to prevent hanging
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout

    const response = await fetch('http://localhost:8080/api/doctors', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Basic ' + btoa('doctor:doctor')
      },
      body: JSON.stringify(doctorData),
      credentials: 'include',
      signal: controller.signal,
      mode: 'cors' // Explicit CORS mode
    });

    clearTimeout(timeoutId);

    // Handle non-2xx responses
    if (!response.ok) {
      let errorDetails;
      try {
        errorDetails = await response.json();
      } catch {
        errorDetails = { message: await response.text() };
      }
      throw new Error(errorDetails.message || `Server responded with ${response.status}`);
    }

    // Success case
    const result = await response.json();

    // Show success message
    const successAlert = document.createElement('div');
    successAlert.className = 'alert alert-success alert-dismissible fade show';
    successAlert.innerHTML = `
      Doctor created successfully! ID: ${result.doctorId || ''}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    document.body.appendChild(successAlert);

    // Close modal and reset form
    const modal = bootstrap.Modal.getInstance(document.getElementById('newDoctorModal'));
    if (modal) modal.hide();
    document.querySelector('#newDoctorModal form').reset();

  } catch (error) {
    console.error('Full error:', error);

    // Special handling for timeout
    if (error.name === 'AbortError') {
      alert('Request timed out. The server is taking too long to respond.');
      return;
    }

    // Special handling for CORS errors
    if (error.message.includes('Failed to fetch')) {
      alert(`Connection error. Please check:
1. The backend server is running
2. No browser extensions are blocking requests
3. You're using the correct URL (currently: http://localhost:8080)
4. Try in Incognito mode`);
      return;
    }

    // General error case
    alert(`Error: ${error.message}`);

  } finally {
    // Reset button state
    submitBtn.disabled = false;
    submitBtn.innerHTML = originalBtnText;
  }
});
</script>



</body>
</html>
